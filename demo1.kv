#:import Factory kivy.factory.Factory

<BoxLayout>:
    height: 30

GridLayout:
    rows: 4
    spacing: 10

    SpeedMeter:
        id: speed
        max: speed_value.max
        tick: 20
        startAngle: -120
        endAngle: 120
        subtick: 5
        label: 'Km/h'
        value: speed_value.value
        cadranColor: '#0f0f0f'
        needleColor: '#ff0000'
        sectors: (0, '#ffffff')

    SpeedMeter:
        id: clock
        min: 0
        max: 12
        tick: 1
        displayFirst: False
        startAngle: 0
        endAngle: 0
        subtick: 5
        cadranColor: '#0000ff'
        shadowColor: '#ffa500'
        labelRadiusRatio: -0.5
        on_value: self.label = '%d s' % (self.value * 6)

    NoValueSpeedMeter:
        id: fuel
        startAngle: 150
        endAngle: 20
        max: 4
        value: 0
        tick: 1
        labelRadiusRatio: 0.4
        labelIcon: 'fuel.png'
        sectors: (0, '#ff0000', 1)
        needleColor: '#ffff00'

    Slider:
        id: speed_value
        max: 200
        size_hint_y: None
        height: sp(28)
        on_value: app.set_speed()
        on_touch_down:
            if self.collide_point(*args[1].pos) and fuel.value <= fuel.min: Factory.fuelPopup().open()

    BoxLayout:
        size_hint_y: None
        height: sp(28)

        Button:
            text: 'Stop'
            size_hint_x: None
            on_press:
                app.clockRunning = not app.clockRunning
                self.text = 'Stop' if app.clockRunning else 'Resume'
        Label:
            text: 'A simple Clock'

    BoxLayout:
        id: layout1
        size_hint_y: None
        height: sp(28)
        orientation: 'vertical'
        Button:
            text: 'Refill !'
            size_hint_x: None
            pos_hint: { 'center_x': 0.5 }
            on_release:
                fuel.value = fuel.max
                speed_value.disabled = False

    SpeedMeter:
        id: temperature
        min: 35
        max: 43
        tick: 1
        startAngle: 90
        endAngle: 270
        labelIcon: 'temp.png'
        labelIconScale: 0.35
        labelRadiusRatio: 0.35
        cadranColor: '#000000'
        sectors: [35, '#0000ff', 40, '#ffff00', 42, '#ff0000', 43]

    SpeedMeter:
        id: rpm
        max: 8
        tick: 1
        startAngle: -120
        endAngle: 120
        subtick: 4
        label: 'rpm'
        sectors: [0, '#000000', 6, '#ffff00', 7, '#ff0000', 8]
        sectorWidth: 5

    SpeedMeter:
        id: pi
        min: 0
        startAngle: -150
        endAngle: 90

<fuelPopup@Popup>:
    BoxLayout:
        orientation: 'vertical'
        size_hint: (0.9, 0.9)
        Label:
            text: "You're out of gas, please refill\nthere's a refill button."
        Button:
            size_hint: (None, None)
            pos_hint: { 'center_x': 0.5 }
            text: 'close'
            on_release:
                app.root.ids.speed_value.value = 0
                app.root.ids.rpm.value = 0
                root.dismiss()
