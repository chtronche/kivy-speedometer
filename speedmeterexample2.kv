#:import Factory kivy.factory.Factory

<TextInput>:
    multiline: False
    size_hint: 1, None
    height: sp(28)

<Button>:
    size_hint: None, None
    height: sp(30)

BoxLayout:
    size: root.size
    padding: 10
    spacing: 10

    BoxLayout:
        orientation: 'vertical'
        size_hint: 0.4, 1

        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1, 0.2

            Label:
                text: 'Click on cadran to set value.\nRight-click to add color sectors.'

        SpeedMeter:
            id: sm
            startAngle: startAngle.value
            endAngle: endAngle.value
            subtick: subtick.value
            displayFirst: displayFirst.active
            displayLast: displayLast.active
            labelRadiusRatio: labelRadiusRatio.value
            labelAngleRatio: labelAngleRatio.value
            labelIconScale: labelIconScale.value

            on_value: display.text = str(self.value)

        Label:
            text: 'Value:'
            size_hint: 1, 0.1

        Label:
            id: display
            text: '0'
            size_hint: 1, 0.1

        Slider:
            size_hint: 1, 0.1
            min: sm.min
            max: sm.max
            value: sm.value
            value_track: True
            on_value: sm.value = self.value

    Label:
        size_hint: 0.1, None

    GridLayout:
        size_hint: 0.6, 1
        cols: 3
        spacing: 10
        cols_minimum: { 0: sp(200), 1: sp(200) }

        Label:
            text: 'min (int)'
        TextInput:
            id: min
            text: str(sm.min)
            on_text_validate: sm.min = int(self.text)
        Label:

        Label:
            text: 'max (int)'
        TextInput:
            id: max
            text: str(sm.max)
            on_text_validate: sm.max = int(self.text)
        Label:

        Label:
            text: 'tick (int)'
        TextInput:
            id: max
            text: str(sm.tick)
            on_text_validate: sm.tick = int(self.text)
        Label:

        Label:
            text: 'subtick (int)'
        Slider:
            id: subtick
            min: 0
            max: 20
            step: 1
        Label:
            text: str(int(sm.subtick))

        Label:
            text: 'displayFirst'
        CheckBox:
            id: displayFirst
            active: True
        Label:

        Label:
            text: 'displayLast'
        CheckBox:
            id: displayLast
            active: True
        Label:

        Label:
            text: 'startAngle (float, -360..360)'
        Slider:
            id: startAngle
            min: -360
            max: 360
            step: 1
            value: -90
        Label:
            text: str(int(sm.startAngle))

        Label:
            text: 'endAngle (float, -360..360)'
        Slider:
            id: endAngle
            min: -360
            max: 360
            step: 1
            value: 135
        Label:
            text: str(int(sm.endAngle))

        Label:
            text: 'cadranColor (as hex)'
        Button:
            text: 'select color'
            on_release:
                dialog = Factory.ColorPickerDialog()
                dialog._exampleCallback = app._setCadranColor
                dialog.open()
        Label:

        Label:
            text: 'label'
        TextInput:
            on_text_validate:
                sm.label = self.text
                app.setLabelControlState()
                
        Label:

        Label:
            text: 'or labelIcon'
        Button:
            text: 'select icon'
            on_release:
                dialog = Factory.FileChooserDialog()
                dialog.open()
        Label:

        Label:
            text: 'labelRadiusRatio (float, -1..1)'
        Slider:
            id: labelRadiusRatio
            min: -1
            max: 1
            value: 0.3
            disabled: True
        Label:
            text: '%.3f' % sm.labelRadiusRatio

        Label:
            text: 'labelAngleRatio (float, 0..1)'
        Slider:
            id: labelAngleRatio
            min: 0
            max: 1
            value: 0.5
            disabled: True
        Label:
            text: '%.3f' % sm.labelAngleRatio

        Label:
            text: 'labelIconScale (float, 0..2)'
        Slider:
            id: labelIconScale
            min: 0
            max: 2
            value: 0.5
            disabled: True
        Label:
            text: str(sm.labelIconScale)

<ColorPickerDialog@ModalView>:
    id: colorpickerdialog
    size_hint: 0.9, 0.9
    BoxLayout:
        orientation: 'vertical'
        spacing: 20

        ColorPicker:
            id: colorpicker
        BoxLayout:
            spacing: 20
            Button:
                text: 'done'
                on_release:
                    colorpickerdialog._exampleCallback(colorpicker.hex_color)
                    colorpickerdialog.dismiss()
            Button:
                text: 'cancel'
                on_release:
                    colorpickerdialog.dismiss()

<FileChooserDialog@ModalView>:
    id: filechooserdialog
    size_hint: 0.9, 0.9
    BoxLayout:
        orientation: 'vertical'
        spacing: 20

        FileChooserIconView:
            id: filechooser        
            path: '.'
            on_submit:
                app.root.ids['sm'].labelIcon = filechooser.selection[0]
                app.setLabelControlState()
                filechooserdialog.dismiss()

        BoxLayout:
            spacing: 20
            Button:
                text: 'cancel'
                on_release:
                    app.setLabelControlState()
                    filechooserdialog.dismiss()
            Button:
                text: 'remove icon'
                on_release:
                    app.root.ids['sm'].labelIcon = ''
                    app.setLabelControlState()
                    filechooserdialog.dismiss()
